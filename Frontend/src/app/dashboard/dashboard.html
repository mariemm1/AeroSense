<!-- src/app/dashboard/dashboard.html -->

<div class="layout">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar__logo">
      <span class="logo-dot"></span>
      <div class="logo-text">
        <span class="logo-title">AeroSense</span>
        <span class="logo-subtitle">Air Quality Monitor</span>
      </div>
    </div>

    <nav class="sidebar__nav">
      <a class="nav-item active">
        <span class="nav-icon">üìä</span>
        <span class="nav-label">Dashboard</span>
      </a>
      <a class="nav-item disabled">
        <span class="nav-icon">üß™</span>
        <span class="nav-label">Models (soon)</span>
      </a>
      <a class="nav-item disabled">
        <span class="nav-icon">üó∫Ô∏è</span>
        <span class="nav-label">Regions</span>
      </a>
      <a class="nav-item disabled">
        <span class="nav-icon">‚öôÔ∏è</span>
        <span class="nav-label">Settings</span>
      </a>
    </nav>

    <div class="sidebar__footer">
      <span class="status-dot online"></span>
      <span class="status-text">System status: <strong>Online</strong></span>
    </div>
  </aside>

  <!-- MAIN PANEL -->
  <div class="main-panel">
    <!-- TOP BAR -->
    <header class="topbar">
      <div class="topbar__left">
        <div class="page-title">
          <h2>Air Quality Dashboard</h2>
          <p>Near-real-time view of atmospheric gases and land surface temperature in Tunisia.</p>
        </div>
      </div>

      <div class="topbar__right">
        <div class="topbar-region">
          <span class="label">Region</span>
          <select [value]="selectedRegion" (change)="onRegionChange($event)">
            <option *ngFor="let r of regions" [value]="r.id">
              {{ r.label }}
            </option>
          </select>
        </div>

        <div
          class="topbar-user"
          (click)="toggleUserMenu()"
          tabindex="0"
          (blur)="closeUserMenu()"
        >
          <div class="user-avatar">
            <span>{{ userName[0] }}</span>
          </div>
          <div class="user-text">
            <span class="hello">Hello,</span>
            <span class="name">{{ userName }}</span>
          </div>
          <span class="chevron">‚ñæ</span>

          <div class="user-menu" *ngIf="userMenuOpen">
            <button type="button">Profile</button>
            <button type="button">Account settings</button>
            <button type="button" class="logout" (click)="onLogout($event)">
              Logout
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- CONTENT -->
    <main class="content">
      <!-- Loading / error messages -->
      <div class="status-banner loading" *ngIf="isLoading">
        Loading latest satellite data for <strong>{{ selectedRegion }}</strong> ‚Ä¶
      </div>
      <div class="status-banner error" *ngIf="!isLoading && errorMessage">
        {{ errorMessage }}
      </div>

      <!-- AQI mini cards -->
      <section class="section">
        <div class="section-header">
          <h3>Key pollutants ‚Äì latest snapshot</h3>
          <span class="section-subtitle">Last processed satellite pass</span>
        </div>

        <div class="aqi-grid">
          <app-card
            *ngFor="let card of aqiCards"
            [hidHeader]="true"
            [options]="false"
            [cardClass]="'aqi-card ' + card.bgClass"
          >
            <div class="aqi-card-inner">
              <div class="aqi-card-header">
                <span class="pollutant">{{ card.pollutant }}</span>
                <span class="level">{{ card.level }}</span>
              </div>
              <div class="aqi-card-value">
                <span class="value">
                  {{
                    card.value !== null && card.value !== undefined
                      ? (card.value | number : '1.1-1')
                      : 'N/A'
                  }}
                </span>
                <span
                  class="unit"
                  *ngIf="card.value !== null && card.value !== undefined"
                >
                  {{ card.unit }}
                </span>
              </div>
              <div class="aqi-card-message" *ngIf="card.message">
                {{ card.message }}
              </div>
            </div>
          </app-card>
        </div>
      </section>

      <!-- Summary KPI row -->
      <section class="section">
        <div class="summary-grid">
          <app-card
            *ngFor="let s of summaryCards"
            [hidHeader]="true"
            [options]="false"
            cardClass="summary-card"
          >
            <div class="summary-card-inner">
              <div class="summary-title">{{ s.title }}</div>
              <div class="summary-value">{{ s.value }}</div>
              <div class="summary-label">{{ s.label }}</div>
              <div class="summary-trend" [ngClass]="s.trend">
                <span *ngIf="s.trend === 'up'">‚ñ≤ Improving</span>
                <span *ngIf="s.trend === 'down'">‚ñº Getting worse</span>
                <span *ngIf="s.trend === 'neutral'">‚ñ† Stable</span>
              </div>
            </div>
          </app-card>
        </div>
      </section>

      <!-- Weekly gas trend + map -->
      <section class="section two-column">
        <div class="col">
          <app-card [options]="false">
            <div class="card-header-inline">
              <div>
                <div class="chart-title">Weekly AQI trend ‚Äì selected gas</div>
                <div class="chart-subtitle">
                  Region: <span class="pill-region">{{ selectedRegion }}</span>
                </div>
              </div>

              <div class="chart-controls">
                <label class="label-gas">
                  Gas
                  <select [value]="selectedGasKey" (change)="onGasChange($event)">
                    <option
                      *ngFor="let g of availableGases"
                      [value]="g"
                    >
                      {{ gasMeta[g]?.label || g }}
                    </option>
                  </select>
                </label>
                <div class="chart-stats">
                  <span>Mean: {{ selectedGasStats.mean | number : '1.2-2' }}</span>
                  <span>Min: {{ selectedGasStats.min | number : '1.2-2' }}</span>
                  <span>Max: {{ selectedGasStats.max | number : '1.2-2' }}</span>
                </div>
              </div>
            </div>

            <apx-chart
              [series]="gasTrendChart.series!"
              [chart]="gasTrendChart.chart!"
              [stroke]="gasTrendChart.stroke!"
              [dataLabels]="gasTrendChart.dataLabels!"
              [xaxis]="gasTrendChart.xaxis!"
              [yaxis]="gasTrendChart.yaxis!"
              [colors]="gasTrendChart.colors!"
              [grid]="gasTrendChart.grid!"
              [legend]="gasTrendChart.legend!"
            ></apx-chart>
          </app-card>
        </div>

        <div class="col">
          <app-card cardTitle="Observation map ‚Äì model-ready view" [options]="false">
            <div class="map-card-body">
              <div class="map-placeholder">
                <img
                  src="https://upload.wikimedia.org/wikipedia/commons/1/1b/Tunisia_location_map.svg"
                  alt="Tunisia map"
                />
                <div class="map-pulse tunis">
                  <span></span>
                  <small>Tunis</small>
                </div>
                <div class="map-pulse sfax">
                  <span></span>
                  <small>Sfax</small>
                </div>
                <div class="map-pulse tozeur">
                  <span></span>
                  <small>Tozeur</small>
                </div>
              </div>
              <p class="map-caption">
                This view will later be driven by your IA model to classify each region
                as <strong>Safe</strong>, <strong>Warning</strong> or <strong>Danger</strong>.
              </p>
            </div>
          </app-card>
        </div>
      </section>

      <!-- LST weekly trend -->
      <section class="section two-column">
        <div class="col col-35">
          <app-card cardTitle="Pollutant contribution" [options]="false">
            <!-- This donut can stay illustrative / static for now -->
            <!-- (you can replace with real values later if you want) -->
            <apx-chart
              [series]="[30, 22, 18, 15, 8, 7]"
              [chart]="{ type: 'donut', height: 260 }"
              [labels]="['NO‚ÇÇ', 'O‚ÇÉ', 'SO‚ÇÇ', 'CO', 'CH‚ÇÑ', 'LST']"
              [plotOptions]="{
                pie: { donut: { size: '72%' } }
              }"
              [colors]="['#73b4ff', '#2ed8b6', '#a768f3', '#4dd0e1', '#ffb64d', '#ff6b81']"
              [legend]="{ position: 'bottom' }"
              [dataLabels]="{ enabled: false }"
            ></apx-chart>
          </app-card>
        </div>

        <div class="col col-65">
          <app-card cardTitle="Land surface temperature ‚Äì weekly trend" [options]="false">
            <div class="chart-subtitle">
              Region: <span class="pill-region">{{ selectedRegion }}</span>
            </div>
            <apx-chart
              [series]="tempTrendChart.series!"
              [chart]="tempTrendChart.chart!"
              [stroke]="tempTrendChart.stroke!"
              [dataLabels]="tempTrendChart.dataLabels!"
              [xaxis]="tempTrendChart.xaxis!"
              [yaxis]="tempTrendChart.yaxis!"
              [fill]="tempTrendChart.fill!"
              [colors]="tempTrendChart.colors!"
              [grid]="tempTrendChart.grid!"
              [tooltip]="tempTrendChart.tooltip!"
            ></apx-chart>
          </app-card>
        </div>
      </section>
    </main>
  </div>
</div>
